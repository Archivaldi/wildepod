<% include ../../partials/header %>
<% include ../../partials/navbar %>

<div class="cleaning_page">
        <% for (let i = 0; i < images.length - 3; i+=4 ) { %>
                <div class="row">
                    <div class="col-1-of-4">
                        <img style="width: 100%; height: 20rem;" src="<%= images[i].image_path %>" alt="<%= images[i].image_name %>">
                        <input type="checkbox" value="<%= images[i].image_id%>">
                    </div>
                    <div class="col-1-of-4">
                        <img style="width: 100%; height: 20rem;" src="<%= images[i+1].image_path %>" alt="<%= images[i].image_name %>">
                        <input type="checkbox" value="<%= images[i+1].image_id%>">
                    </div>
                    <div class="col-1-of-4">
                        <img style="width: 100%; height: 20rem;" src="<%= images[i+1].image_path %>" alt="<%= images[i].image_name %>">
                        <input type="checkbox" value="<%= images[i+2].image_id%>">
                    </div>
                    <div class="col-1-of-4">
                        <img style="width: 100%; height: 20rem;" src="<%= images[i+1].image_path %>" alt="<%= images[i].image_name %>">
                        <input type="checkbox" value="<%= images[i+3].image_id%>">
                    </div>
                </div>
        <% } %>
</div>
        
        <% if (message !== "") { %>
            <h1><%= message%></h1>
        <% } else { %>
            <div class="cleaning_page--btn">
                <button class="btn cleaning_page--btn-1">Mark as Blank</button>
                <button class="btn cleaning_page--btn-2">Stop Cleaning</button>
            </div>
        <% } %>
<% include ../../partials/scripts %>
<script>
    $("button").on("click", function() {
        let blank = [];
        for (let i = 0; i < $("input:checked").length; i++){
            blank.push($("input:checked")[i].value);
        }
        let usable = [];
        for (let i = 0; i < $("input:not(:checked)").length; i++){
            usable.push($("input:not(:checked)")[i].value);
        }
        $.ajax({
            url: "/clean_images",
            method: "POST",
            data: {usable, blank},
            success: function(r) {
                console.log(r)

                let cleaning_page = $(".cleaning_page");
                    cleaning_page.empty();

                if (r.message) {
                    cleaning_page.append(`<h1>${r.message}</h1>`)
                } else {
                    for (let i = 0; i < r.length-3; i+=4){
                        let row = $("<div>").attr("class", "row");
                        for (let j = i; j <= i + 3; j++){
                            let image_div = $("<div>").attr("class", "col-1-of-4");
                            let img = $("<img>").attr("src", r[j].image_path).attr("alt", r[j].image_name).css("width", "100%").css("height", "20rem");
                            let input = $("<input>").attr("type", "checkbox").attr("value", r[j].image_id);
                            image_div.append(img, input);
                            row.append(image_div);
                        };
                        cleaning_page.append(row);
                    
                    };
                };
            }
        });
    });

    $("img").on("click", function() {
        let img = $("<img>").attr("src", this.src).attr("alt", "test").attr("class", "popUp__img");
        let div_popup = $("<div>").attr("class", "popUp");
            div_popup.fadeIn(2000);
            div_popup.append(img);
        $(".cleaning_page").append(div_popup);
    })

    $(document).on("click", ".popUp__img", function() {

        $(".popUp").fadeOut(2000).remove();
    });

    $(".cleaning_page--btn-2").on("click", function() {
        $.ajax({
            url: "/stop_cleaning",
            method: "POST",
            success: window.location.replace("/profile")
        })
    });
</script>
</body>
</html>
